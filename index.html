<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Yii Email Module by cornernote</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Yii Email Module</h1>
        <h2>Easily configurable and powerful email system with templates and email queuing.</h2>
        <a href="https://github.com/cornernote/yii-email-module" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="yii-email-module" class="anchor" href="#yii-email-module"><span class="octicon octicon-link"></span></a>Yii Email Module</h1>

<p>Easily configurable and powerful email system with templates and email queuing.</p>

<h3>
<a name="contents" class="anchor" href="#contents"><span class="octicon octicon-link"></span></a>Contents</h3>

<ul>
<li><a href="#features">Features</a></li>
<li><a href="#screenshots">Screenshots</a></li>
<li>
<a href="#installation">Installation</a>

<ul>
<li><a href="#composer-installation">Composer Installation</a></li>
<li><a href="#manual-installation">Manual Installation</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li>
<a href="#usage">Usage</a>

<ul>
<li><a href="#simple-usage">Simple Usage</a></li>
<li>
<a href="#using-templates">Using Templates</a>

<ul>
<li><a href="#component">Component</a></li>
<li><a href="#php-templates">PHP Templates</a></li>
<li><a href="#db-templates">DB Templates</a></li>
<li><a href="#sending-the-email">Sending the Email</a></li>
</ul>
</li>
<li><a href="#sending-spooled-emails">Sending Spooled Emails</a></li>
<li><a href="#automatically-sending">Automatically Sending</a></li>
<li><a href="#extending-eemailmanager">Extending EEmailManager</a></li>
</ul>
</li>
<li>
<a href="#faq">FAQ</a>

<ul>
<li><a href="#what-is-the-difference-between-a-template-and-a-layout">What is the difference between a template and a layout?</a></li>
<li><a href="#do-layout-variables-subject-heading-and-message-need-to-be-defined-when-calling-buildtemplatemessage-function">Do layout variables subject, heading and message need to be defined when calling buildTemplateMessage() function?</a></li>
<li><a href="#why-does-html-code-get-replaced-htmlencoded-output-when-using-db-templates-rendered-with-mustache">Why does HTML code get replaced htmlencoded output when using db templates rendered with Mustache?</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a></li>
<li><a href="#support">Support</a></li>
<li><a href="#license">License</a></li>
</ul><h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Emails can be sent directly, or saved into a spool to be sent later.</li>
<li>Templates can be normal php files, or stored in the database and rendered with Mustache</li>
<li>Emails are built and send using SwiftMailer</li>
</ul><h2>
<a name="screenshots" class="anchor" href="#screenshots"><span class="octicon octicon-link"></span></a>Screenshots</h2>

<p>Yii Email Module Homepage:
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/home.png" alt="home"></p>

<p>Spool List
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/spools.png" alt="Requests"></p>

<p>Spool View
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/spool.png" alt="Request"></p>

<p>Spool Preview
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/spool-preview.png" alt="Request"></p>

<p>Template List
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/templates.png" alt="Requests"></p>

<p>Template View
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/template.png" alt="Request"></p>

<p>Template Preview
<img src="https://raw.github.com/cornernote/yii-email-module/master/screenshot/template-preview.png" alt="Request"></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Please download using ONE of the following methods:</p>

<h3>
<a name="composer-installation" class="anchor" href="#composer-installation"><span class="octicon octicon-link"></span></a>Composer Installation</h3>

<p>All requirements are automatically downloaded into the correct location when using composer.  There is no need to download additional files or set paths to third party files.</p>

<p>Get composer:</p>

<pre><code>curl http://getcomposer.org/installer | php
</code></pre>

<p>Install latest release OR development version:</p>

<pre><code>php composer.phar require cornernote/yii-email-module:*             // latest release
php composer.phar require cornernote/yii-email-module:dev-master    // development version
</code></pre>

<p>Add the <code>vendor</code> folder to the <code>aliases</code> in your yii configuration:</p>

<div class="highlight highlight-php"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'aliases'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'vendor'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/vendor'</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>

<h3>
<a name="manual-installation" class="anchor" href="#manual-installation"><span class="octicon octicon-link"></span></a>Manual Installation</h3>

<p>Download the <a href="https://github.com/cornernote/yii-email-module/releases/latest">latest release</a> or <a href="https://github.com/cornernote/yii-email-module/archive/master.zip">development version</a> and move the <code>email</code> folder into your <code>protected/modules</code> folder.</p>

<p>In addition the following are required:</p>

<ul>
<li>
<a href="http://www.getyiistrap.com">YiiStrap</a> for the interface elements.  Please follow their Getting Started guide to setup the aliases and components for your application.</li>
<li>
<a href="http://swiftmailer.org/">SwiftMailer</a> to send emails.  Please download and setup the swiftMailerPath as per the Configuration below.</li>
<li>
<a href="https://github.com/bobthecow/mustache.php">MustachePHP</a> to render database templates.  Please download and setup the mustachePath as per the Configuration below.</li>
</ul><h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Add yii-email-module to the <code>modules</code> in your yii configuration:</p>

<div class="highlight highlight-php"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'modules'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// path to the EmailModule class</span>
            <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/vendor/cornernote/yii-email-module/email/EmailModule'</span><span class="p">,</span>

            <span class="c1">// The ID of the CDbConnection application component. If not set, a SQLite3</span>
            <span class="c1">// database will be automatically created in protected/runtime/email-EmailVersion.db.</span>
            <span class="s1">'connectionID'</span> <span class="o">=&gt;</span> <span class="s1">'db'</span><span class="p">,</span>

            <span class="c1">// Whether the DB tables should be created automatically if they do not exist. Defaults to true.</span>
            <span class="c1">// If you already have the table created, it is recommended you set this property to be false to improve performance.</span>
            <span class="s1">'autoCreateTables'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>

            <span class="c1">// The layout used for module controllers.</span>
            <span class="s1">'layout'</span> <span class="o">=&gt;</span> <span class="s1">'email.views.layouts.column1'</span><span class="p">,</span>

            <span class="c1">// Defines the access filters for the module.</span>
            <span class="c1">// The default is EmailAccessFilter which will allow any user listed in EmailModule::adminUsers to have access.</span>
            <span class="s1">'controllerFilters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'emailAccess'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'email.components.EmailAccessFilter'</span><span class="p">),</span>
            <span class="p">),</span>

            <span class="c1">// A list of users who can access this module.</span>
            <span class="s1">'adminUsers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">),</span>

            <span class="c1">// The path to YiiStrap.</span>
            <span class="c1">// Only required if you do not want YiiStrap in your app config, for example, if you are running YiiBooster.</span>
            <span class="c1">// Only required if you did not install using composer.</span>
            <span class="s1">'yiiStrapPath'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/vendor/crisu83/yiistrap'</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>

<p>Add <code>EEmailManager</code> to the <code>components</code> section in your yii configuration:</p>

<div class="highlight highlight-php"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'components'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'emailManager'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// path to the EEmailManager class</span>
            <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'email.components.EEmailManager'</span><span class="p">,</span>

            <span class="c1">// Path to the SwiftMailer lib folder.</span>
            <span class="c1">// Only required if you did not install using composer.</span>
            <span class="s1">'swiftMailerPath'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/vendor/swiftmailer/swiftmailer/lib'</span><span class="p">,</span>

            <span class="c1">// Path to the Mustache src folder.</span>
            <span class="c1">// Only required then templateType is set to "db".</span>
            <span class="c1">// Only required if you did not install using composer.</span>
            <span class="s1">'mustachePath'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/vendor/mustache/mustache/src'</span><span class="p">,</span>

            <span class="c1">// Default from email address.</span>
            <span class="s1">'fromEmail'</span> <span class="o">=&gt;</span> <span class="s1">'webmaster@your.dom.ain'</span><span class="p">,</span>

            <span class="c1">// Default from name.</span>
            <span class="c1">// If unset the application name is used.</span>
            <span class="s1">'fromName'</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>

            <span class="c1">// Template type, can be one of: php, db.</span>
            <span class="s1">'templateType'</span> <span class="o">=&gt;</span> <span class="s1">'php'</span><span class="p">,</span>

            <span class="c1">// When templateType=php this is the path to the email views.</span>
            <span class="c1">// You may copy the default templates from email/views/emails.</span>
            <span class="s1">'templatePath'</span> <span class="o">=&gt;</span> <span class="s1">'application.views.emails'</span><span class="p">,</span>

            <span class="c1">// List of template parts that will be rendered.</span>
            <span class="s1">'templateFields'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'subject'</span><span class="p">,</span> <span class="s1">'heading'</span><span class="p">,</span> <span class="s1">'message'</span><span class="p">),</span>

            <span class="c1">// The default transport to use.</span>
            <span class="c1">// For this example you can use "mail", "smtp" or "anotherSmtp".</span>
            <span class="s1">'defaultTransport'</span> <span class="o">=&gt;</span> <span class="s1">'mail'</span><span class="p">,</span>

            <span class="c1">// A list of email transport methods, for example:</span>
            <span class="c1">//  array(</span>
            <span class="c1">//      'transport_name_or_id' =&gt; array(</span>
            <span class="c1">//          // the class name of the Swift_Transport subclass</span>
            <span class="c1">//          'class' =&gt; 'Swift_Transport',</span>
            <span class="c1">//          // set Swift_Transport::property1 to "my value"</span>
            <span class="c1">//          'property1' =&gt; 'my value',</span>
            <span class="c1">//          // call Swift_Transport::setProperty2("my value")</span>
            <span class="c1">//          'setters' =&gt; array(</span>
            <span class="c1">//              'property2' =&gt; 'my value',</span>
            <span class="c1">//          ),</span>
            <span class="c1">//      ),</span>
            <span class="c1">//  )</span>
            <span class="s1">'transports'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>

                <span class="c1">// mail transport</span>
                <span class="s1">'mail'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="c1">// can be Swift_MailTransport or Swift_SmtpTransport</span>
                    <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'Swift_MailTransport'</span><span class="p">,</span>
                <span class="p">),</span>

                <span class="c1">// smtp transport</span>
                <span class="s1">'smtp'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="c1">// if you use smtp you may need to define the host, port, security and setters</span>
                    <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'Swift_SmtpTransport'</span><span class="p">,</span>
                    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
                    <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span>
                    <span class="s1">'security'</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
                    <span class="s1">'setters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'your_username'</span><span class="p">,</span>
                        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'your_password'</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>

                <span class="c1">// another smtp transport</span>
                <span class="s1">'anotherSmtp'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'Swift_SmtpTransport'</span><span class="p">,</span>
                    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
                    <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span>
                    <span class="s1">'security'</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
                    <span class="s1">'setters'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'another_username'</span><span class="p">,</span>
                        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'another_password'</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">),</span>

        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>

<p>To use the commands that are included with yii-email-manager, add the following to the <code>commandMap</code> section of your yiic configuration:</p>

<div class="highlight highlight-php"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'commandMap'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'emailSpool'</span> <span class="o">=&gt;</span> <span class="s1">'email.commands.EmailSpoolCommand'</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="simple-usage" class="anchor" href="#simple-usage"><span class="octicon octicon-link"></span></a>Simple Usage</h3>

<div class="highlight highlight-php"><pre><span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">emailManager</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">(</span><span class="s1">'user@dom.ain'</span><span class="p">,</span> <span class="s1">'test email'</span><span class="p">,</span> <span class="s1">'&lt;b&gt;Hello&lt;/b&gt; &lt;i&gt;World&lt;i&gt;!'</span><span class="p">);</span>
</pre></div>

<h3>
<a name="using-templates" class="anchor" href="#using-templates"><span class="octicon octicon-link"></span></a>Using Templates</h3>

<p>To send more complex emails you will need to use Email Templates.</p>

<h4>
<a name="component" class="anchor" href="#component"><span class="octicon octicon-link"></span></a>Component</h4>

<p>Create a new component in <code>components/Email.php</code>:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">Email</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">sendUserWelcome</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$emailManager</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">emailManager</span><span class="p">;</span>

        <span class="c1">// build the templates</span>
        <span class="nv">$template</span> <span class="o">=</span> <span class="s1">'user_welcome'</span><span class="p">;</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$emailManager</span><span class="o">-&gt;</span><span class="na">buildTemplateMessage</span><span class="p">(</span><span class="nv">$template</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
        <span class="p">));</span>

        <span class="c1">// get the message</span>
        <span class="nv">$swiftMessage</span> <span class="o">=</span> <span class="nx">Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]);</span>
        <span class="nv">$swiftMessage</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">'message'</span><span class="p">],</span> <span class="s1">'text/html'</span><span class="p">);</span>
        <span class="c1">//$swiftMessage-&gt;addPart($message['text'], 'text/plain');</span>
        <span class="nv">$swiftMessage</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="nv">$emailManager</span><span class="o">-&gt;</span><span class="na">fromEmail</span><span class="p">,</span> <span class="nv">$emailManager</span><span class="o">-&gt;</span><span class="na">fromName</span><span class="p">);</span>
        <span class="nv">$swiftMessage</span><span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>

        <span class="c1">// spool the email</span>
        <span class="nv">$emailSpool</span> <span class="o">=</span> <span class="nv">$emailManager</span><span class="o">-&gt;</span><span class="na">getEmailSpool</span><span class="p">(</span><span class="nv">$swiftMessage</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
        <span class="nv">$emailSpool</span><span class="o">-&gt;</span><span class="na">priority</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="nv">$emailSpool</span><span class="o">-&gt;</span><span class="na">template</span> <span class="o">=</span> <span class="nv">$template</span><span class="p">;</span>
        <span class="nv">$emailSpool</span><span class="o">-&gt;</span><span class="na">transport</span> <span class="o">=</span> <span class="s1">'smtp'</span><span class="p">;</span> <span class="c1">// send using smtp</span>
        <span class="k">return</span> <span class="nv">$emailSpool</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

        <span class="c1">// or send the email</span>
        <span class="c1">//return echo Yii::app()-&gt;emailManager-&gt;deliver($swiftMessage, 'mySmtpTransport');</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="php-templates" class="anchor" href="#php-templates"><span class="octicon octicon-link"></span></a>PHP Templates</h4>

<p>Subject <code>views/emails/example/subject.php</code>:</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="s1">'hello'</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</pre></div>

<p>Heading <code>views/emails/example/heading.php</code>:</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="s1">'Hi there '</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">', Welcome to My Application'</span><span class="p">;</span>
</pre></div>

<p>Message <code>views/emails/example/message.php</code>:</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="s1">'Here is an &lt;b&gt;awesome&lt;/b&gt; email!'</span><span class="p">;</span>
</pre></div>

<h4>
<a name="db-templates" class="anchor" href="#db-templates"><span class="octicon octicon-link"></span></a>DB Templates</h4>

<p>Subject</p>

<pre><code>hello {{user.name}}
</code></pre>

<p>Heading</p>

<pre><code>Hi there {{user.name}}, Welcome to My Application
</code></pre>

<p>Message</p>

<pre><code>Here is an &lt;b&gt;awesome&lt;/b&gt; email!
</code></pre>

<h4>
<a name="sending-the-email" class="anchor" href="#sending-the-email"><span class="octicon octicon-link"></span></a>Sending the Email</h4>

<p>Now you can send an email like this:</p>

<div class="highlight highlight-php"><pre><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">model</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">findByPk</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>
<span class="nx">Email</span><span class="o">::</span><span class="na">sendUserWelcome</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</pre></div>

<h3>
<a name="sending-spooled-emails" class="anchor" href="#sending-spooled-emails"><span class="octicon octicon-link"></span></a>Sending Spooled Emails</h3>

<p>You can send the spooled emails using the yiic command:</p>

<pre><code>yiic emailSpool
</code></pre>

<h3>
<a name="automatically-sending" class="anchor" href="#automatically-sending"><span class="octicon octicon-link"></span></a>Automatically Sending</h3>

<p>Setup <a href="https://github.com/pushcx/lockrun">lockrun</a> for overlap protection.  This allows us to setup a cron job that will run every minute, with no risk of a new process starting if an existing process is running.</p>

<p>Add the following to your crontab:</p>

<pre><code>* * * * * /usr/local/bin/lockrun --idempotent --lockfile=/path/to/app/runtime/emailSpool.lock -- /path/to/yiic emailSpool loop &gt; /dev/null 2&gt;&amp;1
</code></pre>

<h3>
<a name="extending-eemailmanager" class="anchor" href="#extending-eemailmanager"><span class="octicon octicon-link"></span></a>Extending EEmailManager</h3>

<p>Before extending you should check the available configuration options.  In many occasions you can configure the <code>EEmailManager</code> class to behave as you require.</p>

<p>If you wish to extend for more complex functionality, you can simply update the class path in your yii config to point to your own <code>EmailManager</code> class, all the other configuration options will still be available:</p>

<div class="highlight highlight-php"><pre><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'components'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'emailManager'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// path to the EmailManager class</span>
            <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'application.components.EmailManager'</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>

<p>For example, to make the app available to all templates and layouts, you can override <code>buildTemplateMessage()</code>:</p>

<div class="highlight highlight-php"><pre><span class="k">class</span> <span class="nc">EmailManager</span> <span class="k">extends</span> <span class="nx">EEmailManager</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildTemplateMessage</span><span class="p">(</span><span class="nv">$template</span><span class="p">,</span> <span class="nv">$viewParams</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span> <span class="nv">$layout</span> <span class="o">=</span> <span class="s1">'layout_default'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$viewParams</span><span class="p">[</span><span class="s1">'app'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">buildTemplateMessage</span><span class="p">(</span><span class="nv">$template</span><span class="p">,</span> <span class="nv">$viewParams</span><span class="p">,</span> <span class="nv">$layout</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In your PHP templates, you can use:</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="s1">'My app, with ID='</span> <span class="o">.</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">.</span> <span class="s1">' is named '</span> <span class="o">.</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">'!'</span><span class="p">;</span>
</pre></div>

<p>In your DB mustache templates, you can use:</p>

<pre><code>My app, with ID={{app.id}} is named {{app.name}}!
</code></pre>

<h2>
<a name="faq" class="anchor" href="#faq"><span class="octicon octicon-link"></span></a>FAQ</h2>

<h3>
<a name="what-is-the-difference-between-a-template-and-a-layout" class="anchor" href="#what-is-the-difference-between-a-template-and-a-layout"><span class="octicon octicon-link"></span></a>What is the difference between a template and a layout?</h3>

<p>Each of the <strong>template</strong> parts is rendered (<code>subject</code>, <code>heading</code> and <code>message</code>), and then those parts become variables in the <strong>layout</strong>.  </p>

<p>This allows features such as:</p>

<ul>
<li>Consistent pretty message layouts</li>
<li>Your templates remain light with no need for any layout code</li>
<li>Easily change email layouts, for example, send the same email template in December with an xmas layout</li>
<li>Ability to prepend/append to the subject or heading at a more global level (for example if you want your site name in every email subject, you can set your layout subject to "{{subject}} - My Awesome Site"</li>
</ul><p>For an example, let's take a look at a layout and template for a <code>subject</code> part:</p>

<p><strong>TEMPLATE SUBJECT</strong></p>

<pre><code>Welcome {{user.username}}
</code></pre>

<p><strong>LAYOUT SUBJECT</strong></p>

<pre><code>{{subject}} - My Awesome Site
</code></pre>

<p><strong>GENERATED SUBJECT</strong></p>

<pre><code>Welcome cornernote - My Awesome Site
</code></pre>

<p>As you can see, the <code>subject</code> in the <strong>layout</strong> gets replaced by the parsed <code>subject</code> from the <strong>template</strong>.</p>

<h3>
<a name="do-layout-variables-subject-heading-and-message-need-to-be-defined-when-calling-buildtemplatemessage-function" class="anchor" href="#do-layout-variables-subject-heading-and-message-need-to-be-defined-when-calling-buildtemplatemessage-function"><span class="octicon octicon-link"></span></a>Do layout variables <code>subject</code>, <code>heading</code> and <code>message</code> need to be defined when calling <code>buildTemplateMessage()</code> function?</h3>

<p>No, these variables will be created internally based on your the 3 parts of the <strong>template</strong> (<code>subject</code>, <code>heading</code> and <code>message</code>), which will be passed into the <strong>layout</strong>.</p>

<h3>
<a name="why-does-html-code-get-replaced-htmlencoded-output-when-using-db-templates-rendered-with-mustache" class="anchor" href="#why-does-html-code-get-replaced-htmlencoded-output-when-using-db-templates-rendered-with-mustache"><span class="octicon octicon-link"></span></a>Why does HTML code get replaced htmlencoded output when using db templates rendered with Mustache?</h3>

<p>Mustache replaces <code>{{variables}}</code> with the htmlencoded value of the variable, unless you use <code>{{{tripple_culry_braces}}}</code>.  </p>

<ul>
<li>
<code>{{double_curly_braces}}</code> will be htmlencoded</li>
<li>
<code>{{{tripple_culry_braces}}}</code> will allow html</li>
</ul><h2>
<a name="resources" class="anchor" href="#resources"><span class="octicon octicon-link"></span></a>Resources</h2>

<p><a href="http://mrphp.com.au"><img src="https://raw.github.com/cornernote/mrphp-assets/master/img/code-banner.png" alt="Mr PHP"></a> <a href="https://github.com/cornernote/yii-email-module#yii-email-module"><img src="https://raw.github.com/cornernote/mrphp-assets/master/vendor/github/github-latest-sourcecode-16.png" alt="Github Project"></a> <a href="http://www.yiiframework.com/extension/yii-email-module"><img src="https://raw.github.com/cornernote/mrphp-assets/master/vendor/yii/yii-extension-16.png" alt="Yii Extension"></a> <a href="https://www.ohloh.net/p/yii-email-module"><img src="https://www.ohloh.net/p/yii-email-module/widgets/project_thin_badge.gif" alt="Project Stats"></a></p>

<p><a href="https://packagist.org/packages/cornernote/yii-email-module"><img src="https://poser.pugx.org/cornernote/yii-email-module/v/stable.png" alt="Latest Stable Version"></a> <a href="https://travis-ci.org/cornernote/yii-email-module"><img src="https://travis-ci.org/cornernote/yii-email-module.png?branch=master" alt="Build Status"></a> <a href="https://depending.in/cornernote/yii-email-module"><img src="https://depending.in/cornernote/yii-email-module.png" alt="Dependencies Check"></a></p>

<ul>
<li><a href="http://getyiistrap.com/">YiiStrap</a></li>
<li><a href="http://swiftmailer.org/">SwiftMailer</a></li>
<li><a href="https://github.com/bobthecow/mustache.php">MustachePHP</a></li>
<li><a href="https://github.com/pushcx/lockrun">Lockrun</a></li>
<li><a href="http://codeception.com/12-15-2013/testing-emails-in-php">Email Tests</a></li>
<li>Disposable Emails: <a href="http://mailinator.com/">Mailinator</a> <a href="http://maildrop.cc/">MailDrop</a> <a href="http://www.yopmail.com/en/">YopMail</a> <a href="http://10minutemail.com/">10MinuteMail</a>
</li>
<li>Email Trappers: <a href="http://mailtrap.io/">MailTrap</a> <a href="http://mailcatcher.me/">MailCatcher</a>
</li>
</ul><h2>
<a name="support" class="anchor" href="#support"><span class="octicon octicon-link"></span></a>Support</h2>

<ul>
<li>Does this README need improvement?  Go ahead and <a href="https://github.com/cornernote/yii-email-module/edit/master/README.md">suggest a change</a>.</li>
<li>Found a bug, or need help using this project?  Check the <a href="https://github.com/cornernote/yii-email-module/issues">open issues</a> or <a href="https://github.com/cornernote/yii-email-module/issues/new">create an issue</a>.</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="https://raw.github.com/cornernote/yii-email-module/master/LICENSE">BSD-3-Clause</a>, Copyright Â© 2013-2014 <a href="mailto:info@mrphp.com.au">Mr PHP</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/cornernote/yii-email-module/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/cornernote/yii-email-module/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/cornernote/yii-email-module"></a> is maintained by <a href="https://github.com/cornernote">cornernote</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>